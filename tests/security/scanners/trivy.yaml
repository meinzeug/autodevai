# Trivy Security Scanner Configuration
# Container and dependency vulnerability scanning
format: json
severity:
  - CRITICAL
  - HIGH
  - MEDIUM

vulnerability:
  type:
    - os
    - library
  scanners:
    - vuln
    - secret
    - misconfig

secret:
  config: trivy-secret.yaml

misconfig:
  scanners:
    - dockerfile
    - kubernetes
    - terraform

# Skip unfixed vulnerabilities
ignore-unfixed: false

# Exit code configuration
exit-code: 1

# Timeout settings
timeout: 5m

# Skip files/directories
skip-dirs:
  - node_modules
  - .git
  - .npm
  - .cache

skip-files:
  - "*.log"
  - "*.tmp"
  - "package-lock.json"

# Cache configuration
cache:
  clear: false
  
# Offline scan
offline-scan: false

# Security checks for different contexts
docker:
  skip-update: false
  platform: linux/amd64

kubernetes:
  skip-images: false
  components:
    - workload
    - infra

# Output templates
output:
  format: json
  template: |
    {
      "scan_time": "{{ .CreatedAt }}",
      "target": "{{ .ArtifactName }}",
      "type": "{{ .ArtifactType }}",
      "vulnerabilities": {{ len .Results }},
      "results": [
        {{- range $result := .Results }}
        {
          "target": "{{ $result.Target }}",
          "class": "{{ $result.Class }}",
          "type": "{{ $result.Type }}",
          "vulnerabilities": [
            {{- range $vuln := $result.Vulnerabilities }}
            {
              "id": "{{ $vuln.VulnerabilityID }}",
              "pkg_name": "{{ $vuln.PkgName }}",
              "installed_version": "{{ $vuln.InstalledVersion }}",
              "fixed_version": "{{ $vuln.FixedVersion }}",
              "severity": "{{ $vuln.Severity }}",
              "title": "{{ $vuln.Title }}",
              "description": "{{ $vuln.Description }}",
              "references": {{ $vuln.References | toJson }},
              "cvss": {{ $vuln.CVSS | toJson }}
            }{{ if not (isLast $vuln $result.Vulnerabilities) }},{{ end }}
            {{- end }}
          ]
        }{{ if not (isLast $result $.Results) }},{{ end }}
        {{- end }}
      ]
    }

# Report configuration
report:
  format:
    - json
    - table
  output: /tmp/trivy-report.json